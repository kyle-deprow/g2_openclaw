# Phase 0 Spike: `app.json` Manifest Verification Findings

**Date:** 2026-02-22
**CLI version:** `evenhub` 0.1.5
**Tests run:** 17

---

## 1. Complete `app.json` Schema

| Field | Required | Type | Validation Rules |
|-------|----------|------|-----------------|
| `package_id` | **Yes** | `string` | Dot-separated segments. Each segment: starts with lowercase letter, only lowercase letters/digits. Min 2 segments. See §2. |
| `edition` | **Yes** | `string` | Must be exactly `"202601"`. No other value accepted. |
| `name` | **Yes** | `string` | Display name. No length limit observed. |
| `version` | **Yes** | `string` | Must be `x.y.z` semver format (e.g. `"1.0.0"`). |
| `min_app_version` | **Yes** | `string` | Required string. Accepts semver format. |
| `tagline` | **Yes** | `string` | Max 255 characters. Empty string `""` is accepted. |
| `description` | **Yes** | `string` | Max 1024 characters. |
| `author` | **Yes** | `string` | Free-form. Convention: `"Name <email>"`. |
| `entrypoint` | **Yes** | `string` | Path to HTML entry file (e.g. `"index.html"`). |
| `permissions` | No | `object` | Optional. Contains `network` (string array) and `fs` (string array). Wildcard `["*"]` accepted for network. |

**Unknown fields** (e.g. `icon`, `foo`, `category`) are **silently accepted** and included in the `.ehpk` — they do not cause validation errors.

---

## 2. `package_id` Naming Rules

**Pattern:** `^[a-z][a-z0-9]*(\.[a-z][a-z0-9]*)+$`

Rules:
- Dot-separated segments, minimum **2 segments** (e.g. `com.spike` works)
- Each segment must **start with a lowercase letter**
- Each segment allows only **lowercase letters** (`a-z`) and **digits** (`0-9`)
- **No hyphens**, underscores, or uppercase letters anywhere

| Input | Result |
|-------|--------|
| `com.g2openclaw.app` | ✓ Accepted |
| `com.spike` | ✓ Accepted (2 segments) |
| `com.g2-openclaw.app` | ✗ Rejected (hyphen) |
| `com.g2_openclaw.app` | ✗ Rejected (underscore) |
| `com.G2Openclaw.app` | ✗ Rejected (uppercase) |
| `com.2openclaw.app` | ✗ Rejected (segment starts with digit) |

---

## 3. Design Docs vs Reality

The design docs ([03-g2-app-design.md](../../../docs/03-g2-app-design.md) §9) assumed this manifest:

```json
{
  "appId": "com.g2openclaw.app",
  "appName": "OpenClaw",
  "version": "1.0.0",
  "icon": "assets/icon.bmp",
  "entry": "index.html"
}
```

| Design Doc Field | Actual Field | Status |
|-----------------|-------------|--------|
| `appId` | `package_id` | **Wrong name.** Must rename. |
| `appName` | `name` | **Wrong name.** Must rename. |
| `version` | `version` | ✓ Correct. |
| `icon` | *(none — not required)* | **Does not exist in schema.** Silently ignored if present; not functional. |
| `entry` | `entrypoint` | **Wrong name.** Must rename. |
| *(missing)* | `edition` | **Missing.** Required, must be `"202601"`. |
| *(missing)* | `min_app_version` | **Missing.** Required string. |
| *(missing)* | `tagline` | **Missing.** Required (max 255 chars). |
| *(missing)* | `description` | **Missing.** Required (max 1024 chars). |
| *(missing)* | `author` | **Missing.** Required string. |

**Summary:** The design doc got 3 field names wrong, omitted 4 required fields, and included 1 non-functional field. The design doc manifest would fail to pack.

---

## 4. Correct Golden `app.json` for OpenClaw

```json
{
  "package_id": "com.g2openclaw.app",
  "edition": "202601",
  "name": "OpenClaw",
  "version": "0.1.0",
  "min_app_version": "0.1.0",
  "tagline": "AI assistant for Even Realities G2 glasses",
  "description": "Voice-controlled AI assistant that connects G2 smart glasses to a local PC gateway running OpenClaw.",
  "author": "G2 OpenClaw Contributors",
  "entrypoint": "index.html",
  "permissions": {
    "network": ["*"]
  }
}
```

---

## 5. `evenhub init` Reference Template

For comparison, the template generated by `evenhub init`:

```json
{
  "package_id": "com.example.g2demo",
  "edition": "202601",
  "name": "G2 Demo",
  "version": "0.1.0",
  "min_app_version": "0.1.0",
  "tagline": "A short description of the app",
  "description": "A relatively long description of the app",
  "author": "Your Name <dev@example.com>",
  "entrypoint": "index.html",
  "permissions": {
    "network": ["evenhub.evenrealities.com"],
    "fs": ["./assets"]
  }
}
```

---

## 6. Impact on Implementation Plans

### Doc 03 (`03-g2-app-design.md`) — Required Updates

1. **§2 App Structure** — The tree comment says `app.json ← EvenHub manifest (appId, appName, version, icon, entry)`. Must update to `(package_id, name, version, edition, entrypoint, …)`.

2. **§9 `app.json` Manifest** — Replace the entire 5-field manifest block with the correct 10-field golden manifest from §4 above. Replace the field description table.

3. **§2 App Structure** — Remove `assets/icon.bmp` from the directory tree. The `icon` field is not part of the schema. (An icon file could still be included speculatively, but the manifest has no field referencing it.)

4. **§9 Build Steps** — The `evenhub pack` command syntax is `evenhub pack <manifest> <distdir> -o <output>`, not bare `evenhub pack` in a dist directory. Update the build script.

### Doc 05 (`05-architecture-review.md`) — No Changes Needed

The review doc doesn't reference manifest field names directly, so no updates required.

### Phase 1 Tasks (from Architecture Review §8)

| Task | Impact |
|------|--------|
| **Task 3: App skeleton** | Use the golden manifest from §4 above, not the one in doc 03. |
| **Task 4: Display layouts** | No manifest impact. |
| **Build/deploy pipeline** | Must use correct `evenhub pack` syntax with explicit manifest and dist args. |

### General

- Any code or config that references `appId`, `appName`, `entry`, or `icon` as manifest fields must be updated.
- The `edition` field is hardcoded to `"202601"` — treat it as a magic constant for now. Likely tied to the SDK/platform version.
- `permissions.network: ["*"]` works as a wildcard — safe to use during development. Can be scoped for production later.

---

## 7. Test Log

| # | Test | Result |
|---|------|--------|
| 1 | Wrong `edition` value | ✗ `edition: Invalid input: expected "202601"` |
| 2 | Missing `min_app_version` | ✗ `min_app_version: expected string, received undefined` |
| 3 | No `permissions` field | ✓ Packed (427 bytes) |
| 4 | Missing `author` | ✗ `author: expected string, received undefined` |
| 5 | Missing `version` | ✗ `version: must be in x.y.z format` |
| 6 | Missing `tagline` + `description` | ✗ `tagline: must be 255 chars or fewer; description: must be 1024 chars or fewer` |
| 7 | `tagline` > 255 chars | ✗ `tagline: must be 255 characters or fewer` |
| 8 | `description` > 1024 chars | ✗ `description: must be 1024 characters or fewer` |
| 9 | Hyphen in `package_id` | ✗ `must start with lowercase letter, only lowercase letters or numbers` |
| 10 | Underscore in `package_id` | ✗ Same as above |
| 11 | Uppercase in `package_id` | ✗ Same as above |
| 12 | 2-segment `package_id` (`com.spike`) | ✓ Packed (419 bytes) |
| 13 | Segment starts with digit | ✗ Same as test 9 |
| 14 | Golden manifest (wildcard `network: ["*"]`) | ✓ Packed (484 bytes) |
| 15 | Empty `tagline` (`""`) | ✓ Packed (419 bytes) |
| 16 | Unknown field (`icon`) | ✓ Packed (436 bytes) — silently included |
| 17 | Multiple unknown fields (`icon`, `foo`, `category`) | ✓ Packed — silently included |
